"use client";import{a as C}from"../chunk-KIJKY4TU.js";import{useCallback as w,useState as g}from"react";import{EventSourcePlus as E}from"event-source-plus";import _ from"eventemitter3";var y=t=>{let e=new _,r=new E(t,{credentials:"include"}),s={onMessage:async i=>{let n=JSON.parse(i.data);e.emit(n.key,n.payload)}};return[e,()=>r.listen(s)]};var x=(t,e,r=15e3)=>{let[s,c]=g(null);return[w(async()=>await new Promise((n,S)=>{let P=`${t._baseURL}v1/checkouts/client/${e.clientSecret}/stream`,[o,L]=y(P),p=L(),l=!1,d=!1,u=!C(e)||e.productPrice.type!=="recurring",f=!1,a=()=>{l&&d&&u&&c(`Waiting confirmation from ${e.organization.name} `),l&&d&&u&&f&&(p.abort(),n())},k=m=>{m.status==="succeeded"&&(l=!0,c("Payment successful! Processing order..."),o.off("checkout.updated",k),a())};o.on("checkout.updated",k);let h=()=>{d=!0,o.off("checkout.order_created",h),a()};o.on("checkout.order_created",h);let b=()=>{u=!0,o.off("checkout.subscription_created",b),a()};u||o.on("checkout.subscription_created",b);let v=m=>{m.status==="succeeded"&&(f=!0,o.off("checkout.webhook_event_delivered",v),a())};o.on("checkout.webhook_event_delivered",v),setTimeout(()=>{p.abort(),S()},r)}),[t,e,r]),s]};import{loadStripe as A}from"@stripe/stripe-js";import{useCallback as H,useMemo as M,useState as N}from"react";var R=t=>{let[e,r]=N(!1),s=M(()=>t.paymentProcessorMetadata?.intent_status==="requires_action",[t]),c=H(async()=>{if(!s||e)return;let i=await A(t.paymentProcessorMetadata.publishable_key);if(i){r(!0);try{let{intent_client_secret:n}=t.paymentProcessorMetadata;await i.handleCardAction(n)}finally{r(!1)}}},[t,s,e]);return[s,c,e]};export{x as useCheckoutFulfillmentListener,R as useHandleNextAction};
