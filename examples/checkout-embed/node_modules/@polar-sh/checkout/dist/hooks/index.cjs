"use strict";"use client";var R=Object.create;var d=Object.defineProperty;var U=Object.getOwnPropertyDescriptor;var F=Object.getOwnPropertyNames;var $=Object.getPrototypeOf,q=Object.prototype.hasOwnProperty;var D=(e,t)=>{for(var o in t)d(e,o,{get:t[o],enumerable:!0})},S=(e,t,o,c)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of F(t))!q.call(e,r)&&r!==o&&d(e,r,{get:()=>t[r],enumerable:!(c=U(t,r))||c.enumerable});return e};var z=(e,t,o)=>(o=e!=null?R($(e)):{},S(t||!e||!e.__esModule?d(o,"default",{value:e,enumerable:!0}):o,e)),I=e=>S(d({},"__esModule",{value:!0}),e);var J={};D(J,{useCheckoutFulfillmentListener:()=>x,useHandleNextAction:()=>M});module.exports=I(J);var p=require("react");var L=e=>e.product!==null&&e.prices!==null;var _=require("event-source-plus"),E=z(require("eventemitter3"),1),g=e=>{let t=new E.default,o=new _.EventSourcePlus(e,{credentials:"include"}),c={onMessage:async i=>{let n=JSON.parse(i.data);t.emit(n.key,n.payload)}};return[t,()=>o.listen(c)]};var x=(e,t,o=15e3)=>{let[c,r]=(0,p.useState)(null);return[(0,p.useCallback)(async()=>await new Promise((n,A)=>{let H=`${e._baseURL}v1/checkouts/client/${t.clientSecret}/stream`,[s,N]=g(H),h=N(),m=!1,f=!1,l=!L(t)||t.productPrice.type!=="recurring",P=!1,a=()=>{m&&f&&l&&r(`Waiting confirmation from ${t.organization.name} `),m&&f&&l&&P&&(h.abort(),n())},b=k=>{k.status==="succeeded"&&(m=!0,r("Payment successful! Processing order..."),s.off("checkout.updated",b),a())};s.on("checkout.updated",b);let C=()=>{f=!0,s.off("checkout.order_created",C),a()};s.on("checkout.order_created",C);let y=()=>{l=!0,s.off("checkout.subscription_created",y),a()};l||s.on("checkout.subscription_created",y);let v=k=>{k.status==="succeeded"&&(P=!0,s.off("checkout.webhook_event_delivered",v),a())};s.on("checkout.webhook_event_delivered",v),setTimeout(()=>{h.abort(),A()},o)}),[e,t,o]),c]};var w=require("@stripe/stripe-js"),u=require("react"),M=e=>{let[t,o]=(0,u.useState)(!1),c=(0,u.useMemo)(()=>e.paymentProcessorMetadata?.intent_status==="requires_action",[e]),r=(0,u.useCallback)(async()=>{if(!c||t)return;let i=await(0,w.loadStripe)(e.paymentProcessorMetadata.publishable_key);if(i){o(!0);try{let{intent_client_secret:n}=e.paymentProcessorMetadata;await i.handleCardAction(n)}finally{o(!1)}}},[e,c,t]);return[c,r,t]};0&&(module.exports={useCheckoutFulfillmentListener,useHandleNextAction});
